<polymer-element name="safe-list-view" attributes="collection">
    <template>
        <style>
            .list-header {
                position: absolute;
                z-index: 1;
                width: 100%;
                padding: 8px;
                background: rgb(245, 245, 245);
                display: -webkit-box;
                -webkit-box-align: center;
                box-sizing: border-box;
                border-bottom: solid 1px rgba(0, 0, 0, 0.1);
            }

            .list-header > input {
                border: none;
                font-family: inherit;
                font-size: inherit;
                font-weight: inherit;
                -webkit-appearance: none;
                padding: 6px;
                display: block;
                -webkit-box-flex: 1;
                background: white;
                border-radius: 2px;
                margin: 0;
            }

            .list-header > button {
                display: block;
                border: none;
                background: transparent;
                font-size: 30px;
                font-family: inherit;
                font-weight: 100;
                line-height: 15px;
                color: #000;
                margin-left: 8px;
            }

            .list {
                padding-top: 50px;
                overflow: scroll;
                -webkit-overflow-scrolling: touch;
                height: 100%;
                box-sizing: border-box;
            }
        </style>
        <div id="listHeader" class="list-header">
            <input value="{{ filterString }}" type="search" placeholder="type to filter..." />
            <button on-click="{{ addRecordClicked }}">+</button>
        </div>
        <div id="list" class="list">
            <template repeat="{{ record, i in filteredRecords}}">
                <safe-record-item record="{{ record }}" on-click="{{ recordClicked }}" on-delete="{{ deleteClicked }}" index="{{ i }}"></safe-record-item>
            </template>
        </div>
    </template>
    <script>
        Polymer('safe-list-view', {
            observe: {
                filterString: "applyFilter",
                "collection.records": "applyFilter"
            },
            applyFilter: function() {
                var fs = this.filterString;
                this.filteredRecords = fs ? this.collection.records.filter(function(rec) {
                    return rec.name.toLowerCase().search(fs.toLowerCase()) != -1;
                }) : this.collection.records;
            },
            recordClicked: function(event, detail, sender) {
                this.fire("select-record", {record: sender.templateInstance.model.record});
            },
            deleteClicked: function(event, detail, sender) {
                console.log("*** delete clicked ***", arguments);
                this.fire("delete-record", {record: sender.templateInstance.model.record});
            },
            addRecordClicked: function() {
                this.fire("add-record");
            }
        });
    </script>
</polymer-element>