<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="shapeshifter.html">
<link rel="import" href="fast-input.html">

<polymer-element name="padlock-header" attributes="filterString record editingTags">
    <template>
        <link href="header.css" rel="stylesheet" type="text/css">
        <padlock-shapeshifter id="leftIcon" shape="menu" on-tap="{{ leftClicked }}"></padlock-shapeshifter>
        <div class="middle" id="middle">
            <input is="fast-input" id="filterInput" class="filter-input" value="{{ filterString }}" type="search" placeholder="type to filter..." />
            <div class="name">{{ record.name }}</div>
        </div>
        <padlock-shapeshifter id="rightIcon" shape="plus" on-tap="{{ rightClicked }}"></padlock-shapeshifter>
    </template>
    <script>
        Polymer("padlock-header", {
            editingTags: false,
            updateIcons: function() {
                if (this.editingTags) {
                    this.$.leftIcon.shape = "cancel";
                    this.$.rightIcon.shape = "plus";
                } else if (this.record) {
                    this.$.leftIcon.shape = "arrow-left";
                    this.$.rightIcon.shape = "more";
                } else if (this.filterString) {
                    this.$.leftIcon.shape = "";
                    this.$.rightIcon.shape = "cancel";
                } else {
                    this.$.leftIcon.shape = "menu";
                    this.$.rightIcon.shape = "plus";
                }
            },
            recordChanged: function(oldRec, newRec) {
                if (newRec) {
                    this.$.filterInput.setAttribute("disabled", "disabled");
                    this.classList.add("show-record");
                } else {
                    this.$.filterInput.removeAttribute("disabled");
                    this.classList.remove("show-record");
                }
                this.updateIcons();
            },
            leftClicked: function() {
                if (this.editingTags) {
                    this.fire("stop-editing-tags")
                } else if (this.record) {
                    this.fire("back");
                } else {
                    this.fire("menu");
                }
            },
            rightClicked: function() {
                if (this.editingTags) {
                    this.fire("create-tag");
                } else if (this.record) {
                    this.fire("record-menu")
                } else if (this.filterString) {
                    this.filterString = "";
                    this.$.filterInput.blur();
                } else {
                    this.fire("add");
                }
            },
            filterStringChanged: function() {
                if (this.filterString) {
                    this.classList.add("filtering");
                } else {
                    this.classList.remove("filtering");
                }
                thisupdateIcons();
            },
            editingTagsChanged: function() {
                this.updateIcons();
            }
        })
    </script>
</polymer-element>