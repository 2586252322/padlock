<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="padlock-view" attributes="inAnimation outAnimation animationDuration animationEasing maxAnimationDelay">
    <template>
        <link href="view.css" rel="stylesheet" type="text/css">
    </template>
    <script>
        Polymer('padlock-view', {
            headerOptions: {
                show: false,
                leftIconShape: "",
                rightIconShape: "",
                showFilter: false,
                titleText: ""
            },
            inAnimation: "slideInFromRight",
            outAnimation: "slideOutToLeft",
            animationDuration: 400,
            animationEasing: "ease",
            maxAnimationDelay: 200,
            leftHeaderButton: function() {},
            rightHeaderButton: function() {},
            enteredView: function() {
                var self = this;
                var eventName = require(["padlock/util"], function(util) {
                    var eventName = util.getAnimationEndEventName();  
                    self.addEventListener(eventName, function() {
                        self.animationEnd.apply(self, arguments);
                    }, false);
                })
            },
            getAnimationElement: function() {
                return this;
            },
            startAnimation: function(direction, animation, callback) {
                animation = animation || this[direction + "Animation"];
                // animation = "";
                this.currAnimation = animation;
                this.currDirection = direction;
                this.animationCallback = callback;
                var prefix = require("padlock/util").getVendorPrefix().css;

                this.getAnimationElement().style[prefix + "animation"] = [
                    animation,
                    this.animationDuration + "ms",
                    this.animationEasing,
                    0,
                    "both"
                ].join(" ");
                
                if (!animation || !this.animationDuration) {
                    this.fire("animation-end", {direction: direction});
                    if (this.animationCallback) {
                        this.animationCallback();
                        this.animationCallback = null;
                    }
                }
            },
            animationEnd: function(event) {
                if (event.animationName == this.currAnimation) {
                    if (this.animationCallback) {
                        this.animationCallback();
                        this.animationCallback = null;
                    }
                    this.fire("animation-end", {direction: this.currDirection});
                }
            },
            show: function(animation, callback) {
                this.startAnimation("in", animation, callback);
                this.style.display = "";
            },
            hide: function(animation, callback) {
                var self = this;
                this.startAnimation("out", animation, function() {
                    self.style.display = "none";
                    if (callback) {
                        callback();
                    }
                });
            }
        });
    </script>
</polymer-element>