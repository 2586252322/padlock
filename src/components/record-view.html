<polymer-element name="safe-record-view" extends="safe-view" attributes="record editing">
    <template>
        <style>
            :host {
                display: block;
                padding-top: 50px;
                overflow: scroll;
                -webkit-overflow-scrolling: touch;
                height: 100%;
                box-sizing: border-box;
            }

            .field, .add {
                display: -webkit-box;
                border: solid 1px rgba(0, 0, 0, 0.08);
                border-bottom: solid 1px rgba(0, 0, 0, 0.12);
                background: #fff;
                margin: 5px;
                padding: 12px;
            }

            .field > * {
                text-overflow: ellipsis;
            }

            .field > .label {
                max-width: 100px;
                text-align: right;
                color: #539dc6;
            }

            .field > .value {
                -webkit-box-flex: 1;
            }

            .add {
                line-height: 0;
                text-align: center;
                padding: 0;
            }

            .add > safe-shapeshifter {
                display: block;
                width: 26px;
                height: 26px;
                margin: 10px auto;
            }

            .add:hover {
                background: rgba(0, 0, 0, 0.05);
            }

            .add:active:hover:not(.disabled) {
                background: rgba(0, 0, 0, 0.1);
            }
        </style>
        <template repeat="{{ field, i in record.fields }}">
            <div class="field" on-tap="{{ openFieldMenu }}">
                <div class="value">{{ field.value }}</div>
                <div class="label">{{ field.name }}</div>
            </div>
        </template>
        <div class="add" on-tap="{{ addField }}">
            <safe-shapeshifter shape="plus"></safe-shapeshifter>
        </div>
        <safe-dialog id="fieldMenu">
            <div on-tap="{{ editField }}">Edit Field</div>
            <div class="negative" on-tap="{{ removeField }}">Remove Field</div>
        </safe-dialog>
        <safe-dialog id="addFieldDialog">
            <input id="addFieldValueInput" placeholder="Enter Content" />
            <input id="addFieldNameInput" placeholder="Enter Label" />
            <div on-tap="{{ confirmAddField }}">Add</div>
        </safe-dialog>
        <safe-dialog id="editFieldDialog">
            <input id="editValueInput" placeholder="Enter Content" />
            <input id="editNameInput" placeholder="Enter Label" />
            <div on-tap="{{ confirmEditField }}">Save</div>
        </safe-dialog>
    </template>
    <script>
        Polymer('safe-record-view', {
            getAnimationElements: function() {
                return this.shadowRoot.children.array();
            },
            addField: function() {
                this.$.addFieldValueInput.value = "";
                this.$.addFieldNameInput.value = "";
                this.$.addFieldDialog.open();
                this.$.addFieldValueInput.focus();
            },
            confirmAddField: function() {
                this.$.addFieldDialog.close();
                var field = {
                    name: this.$.addFieldNameInput.value,
                    value: this.$.addFieldValueInput.value
                };
                this.record.fields.push(field);
                this.fire("save");
            },
            editField: function() {
                this.$.fieldMenu.close();
                this.$.editValueInput.value = this.selectedField.value;
                this.$.editNameInput.value = this.selectedField.name;
                this.$.editFieldDialog.open();
                this.$.editValueInput.select();
            },
            confirmEditField: function() {
                this.$.editFieldDialog.close();
                this.selectedField.value = this.$.editValueInput.value;
                this.selectedField.name = this.$.editNameInput.value;
                this.fire("save");
            },
            openFieldMenu: function(event, detail, sender) {
                this.selectedField = sender.templateInstance.model.field;
                this.$.fieldMenu.open();
            },
            removeField: function() {
                this.$.fieldMenu.close();
                var util = require("safe/util");
                this.record.fields = util.remove(this.record.fields, this.record.fields.indexOf(this.selectedField));
                this.fire("save");
            }
        });
    </script>
</polymer-element>