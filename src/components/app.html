<polymer-element name="safe-app">
    <template>
        <style>
            :host {
                font-family: Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;
                position: absolute;
                left: 0;
                right: 0;
                bottom: 0;
                top: 0;
                margin: auto;
                font-weight: 300;
                font-size: 18px;
                color: #333;
                -webkit-user-select: none;     
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                -webkit-tap-highlight-color: transparent;

            }

            .view {
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                margin: auto;
                overflow: hidden;
            }

            ::-webkit-search-cancel-button {
                display: none;
            }

            *:focus {
                outline: none;
            }
        </style>
        <safe-list-view id="listView" class="view" collection="{{ collection }}" on-select-record="{{ selectRecord }}" on-delete-record="{{ deleteRecord }}" on-add-record="{{ addRecord }}"></safe-list-view>
        <safe-record-view id="recordView" class="view" on-back="{{ back }}" style="display: none;"></safe-record-view>
    </template>
    <script>
        Polymer("safe-app", {
            ready: function() {
                var self = this;
                require(["safe/model"], function(model) {
                    var coll = new model.Collection();
                    coll.fetch();
                    self.collection = coll;
                });
            },
            selectRecord: function(event, detail, sender) {
                this.openRecord(detail.record);
            },
            deleteRecord: function(event, detail, sender) {
                console.log("** delete ***", arguments);
                this.collection.remove(detail.record);
                this.collection.save();
            },
            openRecord: function(record) {
                this.$.recordView.record = record;
                this.$.listView.style.display = "none";
                this.$.recordView.style.display = "block";
            },
            back: function(event, detail, sender) {
                this.$.recordView.style.display = "none";
                this.$.listView.style.display = "block";
                var record = this.$.recordView.record;
                if (record.name || record.fields.length) {
                    record.name = record.name || "Unnamed";
                    this.collection.save();
                } else {
                    this.collection.remove(record);
                }
            },
            addRecord: function() {
                var record = {
                    name: "",
                    fields: []
                };
                this.collection.add(record);
                this.openRecord(record);
                this.$.recordView.focusTitle();
            }
        });
    </script>
</polymer-element>